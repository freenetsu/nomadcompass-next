generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// NextAuth.js / Auth.js Models (Required)
// ============================================

model User {
  id            String          @id @default(cuid())
  name          String?
  email         String?         @unique
  emailVerified DateTime?
  image         String?
  role          String          @default("user")
  location      String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  accounts       Account[]
  sessions       Session[]
  favorites      Favorite[]
  user_responses UserResponse[]

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// ============================================
// Application-Specific Models
// ============================================

model countries {
  id           String        @id
  name         String        @unique
  code         String        @unique
  flag         String
  continent    String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  country_data country_data?
  favorites    Favorite[]
}

model country_data {
  id                String    @id
  countryId         String    @unique
  costOfLivingIndex Float?
  averageRent       Float?
  averageSalary     Float?
  averageTemp       Float?
  climate           String?
  rainfall          Float?
  safetyIndex       Float?
  healthcareIndex   Float?
  pollutionIndex    Float?
  internetSpeed     Float?
  transportIndex    Float?
  visaRequirements  String?
  taxRate           Float?
  rawData           Json?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  countries countries @relation(fields: [countryId], references: [id], onDelete: Cascade)
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  countryId String
  createdAt DateTime @default(now())

  countries countries @relation(fields: [countryId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, countryId])
  @@map("favorites")
}

model UserResponse {
  id        String   @id @default(cuid())
  userId    String
  responses Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_responses")
}
